(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{176:function(e,t,r){"use strict";r.r(t);var a=r(1),o=r.n(a);function s(e,t,r,a,o,s,i){try{var n=e[s](i),l=n.value}catch(e){return void r(e)}n.done?t(l):Promise.resolve(l).then(a,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var i=e.apply(t,r);function n(e){s(i,a,o,n,l,"next",e)}function l(e){s(i,a,o,n,l,"throw",e)}n(void 0)}))}}var n={data:function(){return{icon:"mdi-tag",resource:"catering/programmings",title:"Programaciones",titleForm:"Programacion",dialog:!1,loading:!1,saving:!1,searchedPreparation:null,selectedWarehouse:null,filter:new Form({warehouse_id:this.$store.getters.warehouseId,date_from:this.$moment().format("YYYY-MM-DD"),date_to:this.$moment().format("YYYY-MM-DD")}),form:new Form({id:null,date:this.$moment().format("YYYY-MM-DD"),professional_id:null,regime_id:null,food_type_id:null,warehouse_id:null,programming_details:[]}),headers:[{text:"ID",value:"id"},{text:"Fecha",value:"date"},{text:"Comida",value:"food_type_descrip"},{text:"Regimen",value:"regime_descrip"},{text:"Professional",value:"professional_fullname"},{text:"Accion",value:"action",sortable:!1}],preparationHeaders:[{text:"Descripcion",value:"preparation_descrip"},{text:"Porciones",value:"portions",width:"80",align:"right"},{text:"Accion",value:"action",align:"center",sortable:!1}],items:[],meta:{professionals:[],regimes:[],food_types:[],preparations:[],warehouses:[]}}},mounted:function(){this.getMeta(),this.getItems()},methods:{addPreparation:function(){var e=this;if(void 0!==this.form.programming_details.find((function(t){return t.preparation_id===e.searchedPreparation.id})))return this.$refs.autocompletePreparation.reset(),void this.$toast("La preparacion ya ha sido agregado","warning",1e3);var t=JSON.parse(JSON.stringify(this.searchedPreparation));this.form.programming_details.push({preparation_id:t.id,preparation_descrip:t.descrip,portions:1}),this.$refs.autocompletePreparation.reset()},removePreparation:function(e,t){this.form.programming_details.splice(t,1)},openForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.form.clear(),this.form.reset(),null!==e)this.form.fill(JSON.parse(JSON.stringify(e))),this.form.date=this.$moment(this.form.date).format("YYYY-MM-DD");else{if(!this.filter.warehouse_id)return void this.$toast("Seleccione un almacen","warning");this.form.warehouse_id=this.filter.warehouse_id}this.dialog=!0},closeForm:function(){this.dialog=!1},getMeta:function(){var e=this;return i(o.a.mark((function t(){var r,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={service:"get-meta-crud-programmings"},t.next=4,e.form.get("/common",{params:r});case 4:a=t.sent,s=a.data,e.meta=s,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.$toast(t.t0.message,"danger");case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},getItems:function(){var e=this;return i(o.a.mark((function t(){var r,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.items=[],e.loading=!0,r={warehouse_id:e.filter.warehouse_id,date_from:e.filter.date_from,date_to:e.filter.date_to},t.next=6,e.filter.get("/".concat(e.resource),{params:r});case 6:a=t.sent,s=a.data,e.items=s,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),e.$toast(t.t0.message,"danger");case 14:return t.prev=14,e.loading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})))()},submit:function(){var e=arguments,t=this;return i(o.a.mark((function r(){var a,s,i,n;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:"create",r.prev=1,t.form.clear(),t.saving=!0,s=t.items.findIndex((function(e){return e.id===t.form.id})),"delete"!==a||confirm("Â¿Realmente desea eliminar el registro?")){r.next=8;break}return t.dialog=!1,r.abrupt("return");case 8:return r.next=10,t.form.req("/".concat(t.resource),a);case 10:i=r.sent,n=i.data,"create"===a&&(t.items.unshift(n),t.$toast("registro creado!","success")),"edit"===a&&(t.items.splice(s,1,n),t.$toast("registro actualizado!","success")),"delete"===a&&(t.items.splice(s,1),t.$toast("registro eliminado!","success")),t.dialog=!1,r.next=21;break;case 18:r.prev=18,r.t0=r.catch(1),r.t0.response&&422===r.t0.response.status?t.form.errors.has("prog_exists")&&t.$toast(t.form.errors.get("prog_exists"),"danger"):t.$toast(r.t0.message,"danger");case 21:return r.prev=21,t.saving=!1,r.finish(21);case 24:case"end":return r.stop()}}),r,null,[[1,18,21,24]])})))()}}},l=r(2),d=Object(l.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-dialog",{attrs:{scrollable:"",persistent:"","max-width":"900px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",[r("span",{staticClass:"headline"},[r("v-icon",{attrs:{left:""}},[e._v(e._s(e.icon))]),e._v("\n                    "+e._s(e.titleForm)+"\n                ")],1)]),e._v(" "),r("v-divider"),e._v(" "),r("v-card-text",{staticClass:"pt-5"},[r("v-row",[r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-row",[r("v-col",{attrs:{cols:"12"}},[r("v-text-field",{attrs:{outlined:"",dense:"",type:"date",label:"Fecha*","hide-details":"auto",error:e.form.errors.has("date"),"error-messages":e.form.errors.get("date")},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12"}},[r("v-select",{attrs:{dense:"",outlined:"",items:e.meta.professionals,label:"Profesional*","item-value":"id","item-text":"fullname","hide-details":"auto",error:e.form.errors.has("professional_id"),"error-messages":e.form.errors.get("professional_id")},model:{value:e.form.professional_id,callback:function(t){e.$set(e.form,"professional_id",t)},expression:"form.professional_id"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12"}},[r("v-select",{attrs:{dense:"",outlined:"",items:e.meta.regimes,label:"Regimen*","item-value":"id","item-text":"descrip","hide-details":"auto",error:e.form.errors.has("regime_id"),"error-messages":e.form.errors.get("regime_id")},model:{value:e.form.regime_id,callback:function(t){e.$set(e.form,"regime_id",t)},expression:"form.regime_id"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12"}},[r("v-select",{attrs:{dense:"",outlined:"",items:e.meta.food_types,label:"Tipo Comida*","item-value":"id","item-text":"descrip","hide-details":"auto",error:e.form.errors.has("food_type_id"),"error-messages":e.form.errors.get("food_type_id")},model:{value:e.form.food_type_id,callback:function(t){e.$set(e.form,"food_type_id",t)},expression:"form.food_type_id"}})],1)],1)],1),e._v(" "),r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-row",[r("v-col",{attrs:{cols:"12"}},[r("v-card",[r("v-toolbar",{staticClass:"elevation-1"},[r("v-autocomplete",{ref:"autocompletePreparation",attrs:{dense:"","single-line":"",items:e.meta.preparations,label:"Agregar preparacion","item-text":"descrip","return-object":"","hide-details":"auto"},on:{change:e.addPreparation},model:{value:e.searchedPreparation,callback:function(t){e.searchedPreparation=t},expression:"searchedPreparation"}})],1),e._v(" "),r("v-data-table",{attrs:{dense:"",headers:e.preparationHeaders,items:e.form.programming_details,"disable-sort":"","disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"item.portions",fn:function(t){var a=t.item,o=t.index;return[r("v-text-field",{attrs:{dense:"",type:"number",min:"0","hide-details":"auto",error:e.form.errors.has("programming_details."+o+".portions"),title:e.form.errors.has("programming_details."+o+".portions")?e.form.errors.get("programming_details."+o+".portions"):null},model:{value:a.portions,callback:function(t){e.$set(a,"portions",t)},expression:"item.portions"}})]}},{key:"item.action",fn:function(t){var a=t.item,o=t.index;return[r("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.removePreparation(a,o)}}},[e._v("\n                                                mdi-delete\n                                            ")])]}}],null,!0)}),e._v(" "),e.form.errors.has("programming_details")?r("small",{staticClass:"error--text px-3",domProps:{innerHTML:e._s(e.form.errors.get("programming_details"))}}):e._e()],1)],1)],1)],1)],1),e._v(" "),r("small",[e._v("*Campos requeridos")])],1),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{attrs:{text:"",disabled:e.saving},on:{click:e.closeForm}},[e._v("close")]),e._v(" "),e.form.id?e._e():r("v-btn",{attrs:{text:"",color:"primary",disabled:e.saving},on:{click:function(t){return e.submit("create")}}},[e._v("Crear")]),e._v(" "),e.form.id?r("v-btn",{attrs:{text:"",color:"error",disabled:e.saving},on:{click:function(t){return e.submit("delete")}}},[e._v("Eliminar")]):e._e(),e._v(" "),e.form.id?r("v-btn",{attrs:{text:"",color:"success",disabled:e.saving},on:{click:function(t){return e.submit("edit")}}},[e._v("Editar")]):e._e()],1)],1)],1),e._v(" "),r("v-card",[r("v-card-title",[r("v-icon",{attrs:{left:""}},[e._v(e._s(e.icon))]),e._v("\n            "+e._s(e.title)+"\n            "),r("v-btn",{staticClass:"ml-3",attrs:{"x-small":"",fab:"",elevation:"1",color:"primary"},on:{click:function(t){return e.openForm()}}},[r("v-icon",[e._v("mdi-plus")])],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-select",{staticStyle:{width:"200px"},attrs:{dense:"",items:e.meta.warehouses,"single-line":"",label:"Almacen*","item-value":"id","item-text":"name","hide-details":"auto",error:e.filter.errors.has("warehouse_id"),"error-messages":e.filter.errors.get("warehouse_id"),clearable:""},model:{value:e.filter.warehouse_id,callback:function(t){e.$set(e.filter,"warehouse_id",t)},expression:"filter.warehouse_id"}})],1),e._v(" "),r("v-card-text",[r("v-row",[r("v-col",{attrs:{cols:"12",sm:"4"}},[r("v-text-field",{attrs:{dense:"",type:"date",label:"Desde*","single-line":"","hide-details":"auto",error:e.filter.errors.has("date_from"),"error-messages":e.filter.errors.get("date_from")},model:{value:e.filter.date_from,callback:function(t){e.$set(e.filter,"date_from",t)},expression:"filter.date_from"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12",sm:"4"}},[r("v-text-field",{attrs:{dense:"",type:"date",label:"Hasta*","single-line":"","hide-details":"auto",error:e.filter.errors.has("date_to"),"error-messages":e.filter.errors.get("date_to")},model:{value:e.filter.date_to,callback:function(t){e.$set(e.filter,"date_to",t)},expression:"filter.date_to"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12",sm:"4"}},[r("v-btn",{attrs:{loading:e.loading,disabled:e.loading},on:{click:e.getItems}},[e._v("\n                        Buscar\n                        "),r("v-icon",{attrs:{right:""}},[e._v("mdi-magnify")])],1)],1)],1)],1),e._v(" "),r("v-data-table",{attrs:{dense:"",headers:e.headers,items:e.items,loading:e.loading,"disable-sort":"","disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"item.date",fn:function(t){var r=t.item;return[e._v("\n                "+e._s(e._f("moment")(r.date,"L"))+"\n            ")]}},{key:"item.action",fn:function(t){var a=t.item;return[r("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.openForm(a)}}},[e._v("\n                    mdi-pencil\n                ")])]}}],null,!0)})],1)],1)}),[],!1,null,null,null);t.default=d.exports}}]);
//# sourceMappingURL=2.js.map